{
  "description": "React server configuration schema",
  "$id": "/config",
  "type": "object",
  "properties": {
    "server": {
      "description": "Server configuration",
      "type": "object",
      "properties": {
        "port": {
          "description": "Server port",
          "type": "integer"
        }
      }
    },

    "bodyparser": {
      "description": "Body parsers",
      "type": "object",
      "properties": {
        "enabled": {
          "description": "Enabled flag",
          "type": "boolean",
          "default": true
        }
      }
    },

    "react": {
      "description": "React configuration",
      "$ref": "/config#/$defs/site"
    },

    "sites": {
      "description": "Subsites configuration",
      "type": "object",
      "patternProperties": {
        "": {
          "$ref": "/config#/$defs/site"
        }
      }
    },

    "redis": {
      "description": "Redis configuration",
      "properties": {
        "url": {
          "description": "Connection string URL",
          "type": ["null", "string"],
          "format": "uri"
        }
      }
    },

    "renderers": {
      "description": "Renderers",
      "type": "object",
      "patternProperties": {
        "": {
          "$ref": "/config#/$defs/renderer"
        }
      }
    },

    "services": {
      "description": "Services",
      "type": "object",
      "patternProperties": {
        "": {
          "description": "Properties required for all services",
          "$ref": "/config#/$defs/service"
        }
      },
      "properties": {
        "cache": {
          "description": "Cache service",
          "type": "object",
          "properties": {
            "engine": {
              "type": "string",
              "enum": ["memcache", "redis"],
              "default": "memcache"
            }
          },
          "required": ["engine"]
        },

        "events": {
          "description": "Events service",
          "type": "object"
        },

        "l10n": {
          "description": "Localization service",
          "type": "object",
          "properties": {
            "path": {
              "description": "Path to locales",
              "type": "string",
              "default": "locales"
            }
          }
        },

        "mailer": {
          "description": "Mailer service",
          "type": "object",
          "properties": {
            "engine": {
              "description": "Mailer engine",
              "type": "string",
              "enum": ["smtp"]
            },

            "smtp": {
              "description": "SMTP interface configuration",
              "type": "object",
              "properties": {
                "server": {
                  "description": "SMTP server configuration as defined in https://nodemailer.com/smtp/",
                  "type": "object",
                  "properties": {
                    "host": {
                      "description": "SMTP server host",
                      "type": "string",
                      "default": "localhost"
                    },
                    "port": {
                      "description": "SMTP server port",
                      "type": "number",
                      "default": 587
                    },
                    "secure": {
                      "description": "Use secure connection (true for 465, false for other ports)",
                      "type": "boolean",
                      "default": false,
                      "enum": [false]
                    },
                    "auth": {
                      "description": "SMTP authentication",
                      "type": "object",
                      "properties": {
                        "user": {
                          "description": "SMTP username",
                          "type": "string"
                        },
                        "pass": {
                          "description": "SMTP password",
                          "type": "string"
                        },
                        "type": {
                          "description": "SMTP authentication type",
                          "type": "string",
                          "enum": ["login", "oauth2"],
                          "default": "login"
                        }
                      }
                    },
                    "authMethod": {
                      "description": "Authentication method",
                      "type": "string",
                      "default": "PLAIN"
                    },
                    "tls": {
                      "description": "TLS",
                      "type": "object",
                      "properties": {
                        "rejectUnauthorized": {
                          "description": "Reject unauthorized flag",
                          "type": "boolean",
                          "default": true
                        },
                        "minVersion": {
                          "description": "Minimum TLS version",
                          "type": "string",
                          "pattern": "TLSv[0-9]+(\\.[0-9]+)?"
                        },
                        "servername": {
                          "description": "must provide server name, otherwise TLS certificate check will fail",
                          "type": "string"
                        }
                      }
                    },
                    "name": {
                      "description": "Optional hostname of the client",
                      "type": "string"
                    },
                    "localAddress": {
                      "description": "Local interface to bind to for network connections",
                      "type": "string"
                    },
                    "connectionTimeout": {
                      "description": "Connection timeout in milliseconds",
                      "type": "number",
                      "default": 120000,
                      "minValue": 1
                    },
                    "greetingTimeout": {
                      "description": "Greeting timeout after connection is established in milliseconds",
                      "type": "number",
                      "default": 30000,
                      "minValue": 1
                    },
                    "socketTimeout": {
                      "description": "Socket timeout in milliseconds",
                      "type": "number",
                      "default": 6000000,
                      "minValue": 1
                    }
                  }
                }
              }
            }
          }
        }
      }
    },

    "session": {
      "description": "Request sessions",
      "properties": {
        "enabled": {
          "description": "Enabled flag",
          "type": "boolean",
          "default": true
        },
        "secret": {
          "description": "Session secret key",
          "type": "string",
          "default": "session-secret"
        }
      },
      "required": ["enabled", "secret"]
    }
  },

  "$defs": {
    "language": {
      "description": "ISO-639-1 language codes",
      "type": "string",
      "pattern": "^[a-z]{2}$"
    },

    "locale": {
      "description": "Locale",
      "type": ["null", "string"],
      "pattern": "^[a-z]{2}_[A-Z]{2}$"
    },

    "renderer": {
      "description": "Renderer",
      "type": "object",
      "properties": {
        "module": {
          "description": "Node module name",
          "type": "string"
        },
        "path": {
          "description": "View path",
          "type": "string"
        }
      },
      "required": ["module", "path"]
    },

    "service": {
      "type": "object",
      "properties": {
        "enabled": {
          "description": "Enabled flag",
          "type": "booleam",
          "enum": [true, false],
          "default": false
        }
      }
    },

    "site": {
      "description": "Site configuration",
      "type": "object",
      "properties": {
        "enabled": {
          "description": "Enabled flag",
          "type": "boolean",
          "default": true
        },

        "entry": {
          "description": "Entry filename",
          "type": "string"
        },

        "host": {
          "description": "React host definitions",
          "type": "object",
          "properties": {
            "name": {
              "description": "Host name i.e. DNS",
              "type": ["null", "string"],
              "default": "localhost"
            },
            "port": {
              "description": "Host port",
              "type": ["null", "number"],
              "default": 80
            },
            "ssl": {
              "description": "SSL flag",
              "type": ["null", "boolean"],
              "default": false
            }
          }
        },

        "stylesheets": {
          "description": "Included stylesheets",
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },

        "minified": {
          "description": "Use minified versions of JS and CSS files flag",
          "type": ["null", "boolean"],
          "default": false
        },

        "fingerprint": {
          "description": "Use current git commit as static file identifier flag",
          "type": ["null", "boolean"],
          "default": false
        },

        "defaultLocale": {
          "description": "Default locale",
          "$ref": "/config#/$defs/locale"
        },
        "locales": {
          "description": "Site locales",
          "type": ["null", "object"],
          "patternProperties": {
            "^[a-z]{2}": {
              "$ref": "/config#/$defs/locale"
            }
          }
        },

        "application": {
          "description": "Public application configuration",
          "type": "object",
          "properties": {
            "defaultLanguage": {
              "description": "Default language",
              "$ref": "/config#/$defs/language"
            },

            "languages": {
              "type": ["null", "array"],
              "items": [
                "/config#/$defs/language"
              ]
            },

            "site": {
              "description": "Site metadata definitions",
              "type": "object",
              "properties": {
                "title": {
                  "type": "string",
                  "default": "Site title"
                },
                "logo": {
                  "type": "string"
                },
                "provider": {
                  "type": "string"
                }
              },
              "required": ["title"]
            }
          }
        }
      }
    }
  }
}
